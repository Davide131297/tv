name: Weekly Threads Bot Post

on:
  schedule:
    # Run at 09:00 CET (08:00 UTC) every Monday
    - cron: "0 8 * * 1"
  workflow_dispatch: # Allow manual triggering from GitHub UI

jobs:
  post-to-threads:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Threads Bot API
        run: |
          echo "üöÄ Starte Threads Bot..."
          RESPONSE=$(curl --silent --show-error --fail \
            --max-time 1800 \
            --request GET \
            --header "Authorization: Bearer ${{ secrets.CRAWL_API_KEY }}" \
            --header "Content-Type: application/json" \
            "${{ secrets.DEPLOYMENT_URL }}/api/threads-bot/weekly")

          echo "‚úÖ:"
          echo "$RESPONSE" | python3 -m json.tool || echo "$RESPONSE"

      - name: Fehler melden
        if: failure()
        run: |
          echo "‚ùå Threads Bot Job fehlgeschlagen!"
          exit 1
